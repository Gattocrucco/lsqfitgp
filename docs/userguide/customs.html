<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>6. A custom kernel: text classification &#8212; lsqfitgp documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=f6a572b4" />
    <script src="../_static/documentation_options.js?v=841cbeb9"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Multidimensional input" href="in.html" />
    <link rel="prev" title="5. Taking integrals" href="integrals.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">lsqfitgp</a></h1>



<p class="blurb">A general purpose Gaussian process regression module</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=Gattocrucco&repo=lsqfitgp&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="userguide.html">Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">1. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="sine.html">2. First example: a sine</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernels.html">3. More on kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="derivatives.html">4. Taking derivatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="integrals.html">5. Taking integrals</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6. A custom kernel: text classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="in.html">7. Multidimensional input</a></li>
<li class="toctree-l2"><a class="reference internal" href="partial.html">8. Partial derivatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="out.html">9. Multidimensional output</a></li>
<li class="toctree-l2"><a class="reference internal" href="components.html">10. Splitting components</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyper.html">11. Hyperparameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyperstruct.html">12. Hyperparameters in the input</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonlinear.html">13. Nonlinear models</a></li>
<li class="toctree-l2"><a class="reference internal" href="optim.html">14. Optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examplesref.html">Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/development.html">Development</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="userguide.html">Guide</a><ul>
      <li>Previous: <a href="integrals.html" title="previous chapter"><span class="section-number">5. </span>Taking integrals</a></li>
      <li>Next: <a href="in.html" title="next chapter"><span class="section-number">7. </span>Multidimensional input</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="integrals.html" title="Previous document"><span class="section-number">5. </span>Taking integrals</a>
        </li>
        <li>
          <a href="in.html" title="Next document"><span class="section-number">7. </span>Multidimensional input</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="a-custom-kernel-text-classification">
<span id="customs"></span><h1><span class="section-number">6. </span>A custom kernel: text classification<a class="headerlink" href="#a-custom-kernel-text-classification" title="Link to this heading">¶</a></h1>
<p>In the previous sections of the manual we always used the <a class="reference internal" href="../reference/kernelsref.html#lsqfitgp.ExpQuad" title="lsqfitgp.ExpQuad"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExpQuad</span></code></a>
kernel. There are many other kernels available in the module; however, it will
be useful to build at least once our own kernel to understand more about how
kernels work.</p>
<p>First I will make up a problem for which there’s not already a reasonable kernel
in the module. Let’s say we want to recognize automatically the language of a
text. To keep things simple, we will use only two languages, English and Latin.
To represent this binary classification problem with a Gaussian process, we
consider a “score” which is modeled as a Gaussian process. Negative scores
correspond to English, positive scores correspond to Latin. Example: if the
prior for a text score is <span class="math notranslate nohighlight">\(0 \pm 1\)</span>, it means there’s 50 % probability
it’s English and 50 % it’s Latin. In general we have to integrate a Gaussian
distribution over the negative/positive semiaxis.</p>
<p>Without using statistical techniques, writing a language identification program
is quite simple; we could just put a list of common words for each language and
count the words in the text. However, for the sake of the example, we will
write a dumb kernel that has no internal knowledge of the languages and doesn’t
even consider words.</p>
<p>How do we make a kernel over texts? We always talked about kernels as functions
of real numbers, but actually the definition did not require <span class="math notranslate nohighlight">\(x\)</span> and
<span class="math notranslate nohighlight">\(x'\)</span> to be numbers. It didn’t require them to be <em>anything</em>. In
<a class="reference internal" href="kernels.html#kernelexpl"><span class="std std-ref">More on kernels</span></a> we wrote the positivity requirement with an integral, but it
can also be written as a sum:</p>
<div class="math notranslate nohighlight">
\[\forall g: \sum_x \sum_{x'} g(x) k(x, x') g(x') \ge 0.\]</div>
<p>It still holds that a function of the form <span class="math notranslate nohighlight">\(k(x, x') = \sum_i h_i(x)
h_i(x')\)</span> is a valid kernel. So if we invent a family of functions <span class="math notranslate nohighlight">\(h_i\)</span>
on texts we are done. This kind of construction is called <em>mapping to feature
space</em>, each <span class="math notranslate nohighlight">\(h_i\)</span> measures a “feature” of its input that matters for the
problem. The simplest functions we can define for texts are</p>
<div class="math notranslate nohighlight">
\[h_i(x) = \text{how many times letter $i$ appears in text $x$}.\]</div>
<p>What does this mean practically? Fix <span class="math notranslate nohighlight">\(i = \texttt{a}\)</span>. Then
<span class="math notranslate nohighlight">\(h_\texttt{a}(x) h_\texttt{a}(x')\)</span> just multiplies the number of “a” in
two texts. If a text has no “a” at all, it will be zero-a-correlated with any
other text. Texts with a lot of “a” will be much a-correlated between them.</p>
<p>Let’s put this into code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lsqfitgp</span> <span class="k">as</span> <span class="nn">lgp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nd">@lgp</span><span class="o">.</span><span class="n">kernel</span>
<span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
<span class="k">def</span> <span class="nf">CountLetters</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s1">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span><span class="p">:</span>
        <span class="n">xcount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">character</span> <span class="o">==</span> <span class="n">letter</span><span class="p">:</span>
                <span class="n">xcount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ycount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">character</span> <span class="o">==</span> <span class="n">letter</span><span class="p">:</span>
                <span class="n">ycount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">xcount</span> <span class="o">*</span> <span class="n">ycount</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>We wrote a function that counts the occurences of a letter, multiplies the
counts, and then sums over all letters. We then applied two decorators:
<code class="docutils literal notranslate"><span class="pre">np.vectorize</span></code>, which applies the function to each text in <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>
when they are arrays instead of single texts, and <code class="docutils literal notranslate"><span class="pre">lgp.kernel</span></code>, which marks
the function as a kernel for <a class="reference internal" href="../index.html#module-lsqfitgp" title="lsqfitgp"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lsqfitgp</span></code></a>. The decorator order matters:
first we transform the function to make it work on arrays, and only then we
can apply <code class="docutils literal notranslate"><span class="pre">&#64;lgp.kernel</span></code> to mark it as a kernel.</p>
<p>Note that this function is disastrously inefficient, I just wrote it to be as
clear as possible.</p>
<p>Now we need some texts. I’ll copy-pasted the first paragraph of random articles
from the <a class="reference external" href="https://en.wikipedia.org/wiki/Special:Random">English</a> and <a class="reference external" href="https://la.wikipedia.org/wiki/Specialis:Pagina_fortuita">Latin</a> wikipedias.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">english_texts</span> <span class="o">=</span> <span class="p">[</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Kiy Island (Russian: Кий-остров) is an island in the Onega Bay of the White Sea, 8 km off-shore and 15 km from the town of Onega. The island stretches for 2 kilometres from north-west to south-east, but its width does not exceed 800 meters. The island includes wide and sandy beaches, piny woods rich with berries, and large rocks. It has a remarkably interesting architectural ensemble, and hosts the history of the Kiysky Krestny monastery. Thousands of tourists go and visit the island.[1]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Haakon Andreas Olsen (18 September 1923[citation needed] – 22 August 2010) was a Norwegian physicist.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Le Chant des chemins de fer (The Song of the Railways) is a cantata in B minor by Hector Berlioz for tenor solo, choir and orchestra composed in June 1846 on lyrics by Jules Janin and premiered June 14 1846 for the inauguration of the gare de Lille.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Omanaia (Māori: Ōmanaia) is a settlement in the Hokianga area of Northland, New Zealand.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Printed electronics is a set of printing methods used to create electrical devices on various substrates. Printing typically uses common printing equipment suitable for defining patterns on material, such as screen printing, flexography, gravure, offset lithography, and inkjet. By electronic industry standards, these are low cost processes. Electrically functional electronic or optical inks are deposited on the substrate, creating active or passive devices, such as thin film transistors; capacitors; coils; resistors. Printed electronics is expected to facilitate widespread, very low-cost, low-performance electronics for applications such as flexible displays, smart labels, decorative and animated posters, and active clothing that do not require high performance.[1]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The Battle of Blair&#39;s Landing was fought on April 12, 1864, in Red River Parish, Louisiana, as a part of the Red River Campaign of the American Civil War.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bradley Godden (born 13 July 1969) is an Australian former professional rugby league footballer who played in the 1990s. He played for the Newcastle Knights, Hunter Mariners, and the Leeds Rhinos as a fullback, wing or centre.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Milecastle 22 (Portgate) was a milecastle of the Roman Hadrian&#39;s Wall. Its remains exist as a low, turf covered platform just east of the Portgate roundabout (junction of the A68 and B6318). The platform is 0.5 metres (1.6 ft) on the east side, reducing to only a parch mark on the west side.[1]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mešeišta is a village in the Debarca Municipality, Macedonia. It sits on the border between the Debarca Municipality and Ohrid Municipality, but administratively belongs to the former. Its FIPS code was MK65.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Taubensee (Kössen/Unterwössen) is a lake of Tyrol, Austria.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Local elections were held in Scotland in May 1992, to elect members to all 53 district councils. It was the last local election held under the Local Government (Scotland) Act 1973, which had established the two-tier system of regions and districts. Regional and district councils were abolished in 1996, and replaced with 29 new mainland unitary authorities under the terms of the Local Government etc. (Scotland) Act 1994.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;New Fork is a ghost town in Sublette County, Wyoming, United States, near Boulder. It was one of the earliest settlements in the upper Green River valley. New Fork was established in 1888 by John Vible and Louis Broderson, Danish immigrants who had arrived in the United States in 1884. They established a store along the Lander cut-off of the Oregon Trail. By 1908 a small town had grown around the store, and in 1910 Vible built a dance hall, called The Valhalla.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;Tell Me You&#39;re Mine&quot; is a song written by Ronald L. Fredianelli and Dico Vasin and performed by The Gaylords. It reached #2 on the U.S. pop chart and #3 on Cashbox in 1953.[1]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;In Greek mythology, Hyettus (Ancient Greek: Ὕηττος - Hyettos) was a native of Argos thought to have been the first man ever to have exacted vengeance over adultery: he reputedly killed Molurus, whom he had caught with his wife, and was sent into exile. King Orchomenus of Boeotia received him hospitably and assigned to him some land, where the village Hyettus was subsequently founded and named after him.[1][2]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sanxiantai[1] (Amis: nuwalian; Chinese: 三仙台; pinyin: Sānxiāntái) is an area containing a beach and several islands located on the coast of Chenggong Township, Taitung County, Taiwan. The beach stretches for ten kilometers in length. It is situated at the 112-kilometer mark. A popular tourist attraction for its rocky coastal views, the area is well known for its long footbridge in the shape of a sea dragon that connects the coast to the largest island.[2] The name Sanxiantai means &quot;three immortals platform&quot;, referring to the island with three large standing rocks.[3]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A number of steamships have been named Delphine&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Animaux is a French television channel themed on the animal world.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lin Li, FREng, CEng, FIET, FLIA, FCIRP (Chinese: 李林; pinyin: Lǐ Lín), is professor of laser engineering at the University of Manchester Institute of Science and Technology.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;In various urban activities, a vault is any type of movement that involves overcoming an obstacle by jumping, leaping, climbing or diving over an obstacle while using their feet, hands or not touching it at all. Although Parkour doesn&#39;t involve the idea of set movements,[1] traceurs use similar ways of moving [2] to quickly and efficiently pass over obstacles.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pocono Airlines was a regional airline operating out of Pocono Mountains Municipal Airport and Wilkes-Barre/Scranton International Airport, founded by Walter E. (&quot;Wally&quot;) Hoffman Jr.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strokkers is a Spanish children&#39;s animated series produced by Neptuno Films in 2002. It was created by Josep Viciana and designed by Roman Rybakiewicz (both of whom were also involved in production for another Netpuno Films series Connie the Cow).&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Harrison Fraker, FAIA is a professor of Architecture and Urban Design, and the former Dean of the UC Berkeley College of Environmental Design.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;Did It in a Minute&quot; is a song performed by American musical duo Hall &amp; Oates. Written by member Daryl Hall with Sara and Janna Allen, the song was released as the third of four singles from their tenth studio album Private Eyes in March 1982. Daryl Hall performs lead vocals, while John Oates provides backing harmony vocals.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chaerodrys is a genus of obese weevils (insects in the family Brachyceridae).&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A photographic album, or photo album, is a series of photographic prints collected by an individual person or family in the form of a book.[1][2][3] Some book-form photo albums have compartments which the photos may be slipped into; other albums have heavy paper with an abrasive surface covered with clear plastic sheets, on which surface photos can be put.[4] Older style albums often were simply books of heavy paper on which photos could be glued to or attached to with adhesive corners or pages.[4]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">latin_texts</span> <span class="o">=</span> <span class="p">[</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Colloretum[1] (-i, n.) (alia nomina: Colloredum Montis Albani) (Italiane: Colloredo di Monte Albano; Foroiuliensice: Colorêt di Montalban) est oppidum Italiae et municipium, in Regione Foro Iulii-Venetia Iulia et in Provincia Utinensi situm.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lánzhōu,[1] seu fortasse Lanceu[2] (litteris Sinicis 兰州), est urbs Serica et caput provinciae Gansu.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aizecourt-le-Bas est commune Francicum 58 incolarum (anno 2009) praefecturae Samara in regione Picardia.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;4009 Drobyshevskij,[1] olim designationibus 1977 EN1, 1982 BP3, et 1984 SP5 agnitus, est asteroides systematis solaris nostri, asteroidibus Cinguli Principalis attributus. Astronomis terrestribus magnitudinem absolutam 12.50 monstrat. Die 13 Martii 1977 a Nicolao Stepanovich Chernykh, astronomo apud Observatorium Astrophysicum Crimaeae versato, repertus est.[2]&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vaslui (Dacoromanice Județ Vaslui) est unus quadraginta duorum (cum urbe Bucaresto) Romaniae circulorum. Urbs eiusdem nominis est caput huius circuli, cui 455550 incolarum (anno 2002) sunt.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Argentolium[1] (Francogallice Argenteuil) est urbs et commune Francicum 104&#39;962 incolarum (anno 2012) praefecturae Valle Esiae in regione Insula Franciae.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rimogne est commune Francicum 1&#39;423 incolarum (anno 2010) praefecturae Arduennae in regione Campania et Arduenna.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Respublica Helvetica vocabatur civitas quam Helvetis invitis anno 1798 Francici Confoederationem Helveticam invasi e tredecim pagis constituerunt.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hills Road Sixth Form College (&quot;Collegium sextae classis ad Viam Collium&quot;) est coeducationalis schola publica Cantabrigiae in Anglia sita, quae solum in forma sexta plenum graduum AS et A curriculum circa 2100 iuvenibus annos ab 16 ad 18 habentibus ex regione circumdante, ac cursus varissimos circa quattuor milibus discipulorum omnium annorum ad tempus in ratione educationis adultorum in classibus interdiu nocteque habitis praebet.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aucopolis[1][2] (Anglice Auckland, Maorice Tamaki Makaurau) est urbs maxima Novae Zelandiae. Urbi regionique metropolitanae sunt 1 454 300 incolarum, ac 32 centesimae incolarum Novae Zelandiae sunt. Aucopolis in parte septentrionali Insulae Septentrionalis sita est.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vaprium[1] (-i, n.) (alia nomina: Vavris[2]) (Italiane: Vaprio d&#39;Adda) est oppidum Italiae et municipium, circiter 9 000 incolarum, in regione Langobardia et in Urbe metropolitana Mediolanensi situm. Incolae Vaprienses appellantur.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mirepoix (Gasconice Mirapeish) est commune 197 incolarum (anno 2008) Franciae praefecturae Aegirtii in regione Meridiano et Pyrenaeo.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Volsci[1] populus antiquus Italiae atque diu hostes Romanorum fuerunt.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lantenay est commune Francicum 263 incolarum (anno 2012) praefecturae Indis in regione orientali Rhodano et Alpibus (a die 1 Ianuarii 2016 Arvernia Rhodano et Alpibus).&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Étouy est commune Francicum 795 incolarum (anno 2012) praefecturae Esiae in regione Picardia.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Astropecten polyacanthus est species stellae marinae familiae astropectinidarum.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Statoniensis lacus[1][2] (alia nomina: Mezzani lacus) (Italiane: Lago di Mezzano) est parvus lacus Italiae, in Regione Latio, in Provincia Viterbiensi et in municipium Valentani situm, prope Lacum Volsiniensem.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Annus 11 a.C.n. e serie paginarum brevium de annis.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Anna Reagan (Anglice saepissime Nancy Reagan, nata Anne Frances Robbins Novi Eboraci in urbe die 6 Iulii 1921; domi mortua Bel Air in oppido prope Angelopolim Californiae die 6 Martii 2016[1][2]), alumna Collegii Smith ubi rebus scaenicis studuit, fuit actrix Americana atque ab anno 1952 uxor Ronaldi Reagan. Quo praeside Civitatum Foederatarum electo, Anna Reagan ab anno 1981 ad annum 1989, coniunx praesidis, titulum Anglicum First Lady gessit.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saint-Martial-d&#39;Albarède est commune Francicum 490 incolarum (anno 2011) praefecturae Duranii in regione Aquitania.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Béla Németh (sive Bela Nemeth) sive Adalbertus Németh, est poeta Latinus Hungaricus.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Franciscus Salmhofer (Vindobonae natus die 22 Ianuarii 1900; ibidem mortuus die 22 Septembris 1975) fuit poeta, compositor et concentus magister Austriacus, qui inter alia Wiener Staatsoper praefectus fuit.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deversorium Astoria sive vulgo Hôtel Astoria est clarum historicum et lautissimum deversorium quinque stellarum Bruxellis Belgii situm, locus clarus in quem affluunt iam ante unum saeculum homines famosi, reges, scriptores et regentes mundi.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Concressault est commune Francicum 221 incolarum (anno 2011) praefecturae Cari in regione Media.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clairfayts est commune 356 incolarum (anno 2008) praefecturae Septentrionis in Franciae borealis regione Septentrione et Freto.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Ok, so we have 25 english texts and 25 latin texts. There’s some contamination,
like the latin wikipedia page on the <em>Hills Road Sixth Form College</em>, but this
is life. Let’s put all this in a Gaussian process object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gp</span> <span class="o">=</span> <span class="p">(</span><span class="n">lgp</span>
    <span class="o">.</span><span class="n">GP</span><span class="p">(</span><span class="n">CountLetters</span><span class="p">())</span>
    <span class="o">.</span><span class="n">addx</span><span class="p">(</span><span class="n">english_texts</span><span class="p">,</span> <span class="s1">&#39;english&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">addx</span><span class="p">(</span><span class="n">latin_texts</span><span class="p">,</span> <span class="s1">&#39;latin&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>I’m a bit worried. Will this mess really work? I’ll look at the prior to see
if it makes sense before going on:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prior</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">prior</span><span class="p">()</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">texts</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="n">english_texts</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;latin&#39;</span><span class="p">,</span> <span class="n">latin_texts</span><span class="p">)]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*****&#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="s1">&#39;*****&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">texts</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   &#39;</span><span class="p">,</span> <span class="n">texts</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">20</span><span class="p">],</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">prior</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>***** english *****
   Kiy Island (Russian:    0(95)
   Haakon Andreas Olsen    0(17)
   Le Chant des chemins    0(47)
   Omanaia (Māori: Ōman    0(20)
   Printed electronics     0(169)
   The Battle of Blair&#39;    0(28)
   Bradley Godden (born    0(42)
   Milecastle 22 (Portg    0(55)
   Mešeišta is a villag    0(41)
   Taubensee (Kössen/Un    0(13)
   Local elections were    0(85)
   New Fork is a ghost     0(88)
   &quot;Tell Me You&#39;re Mine    0(30)
   In Greek mythology,     0(81)
   Sanxiantai[1] (Amis:    0(117)
   A number of steamshi    0(12)
   Animaux is a French     0(15)
   Lin Li, FREng, CEng,    0(31)
   In various urban act    0(72)
   Pocono Airlines was     0(39)
   Strokkers is a Spani    0(48)
   Harrison Fraker, FAI    0(29)
   &quot;Did It in a Minute&quot;    0(61)
   Chaerodrys is a genu    0(17)
   A photographic album    0(98)
***** latin *****
   Colloretum[1] (-i, n    0(52)
   Lánzhōu,[1] seu fort    0(20)
   Aizecourt-le-Bas est    0(23)
   4009 Drobyshevskij,[    0(71)
   Vaslui (Dacoromanice    0(39)
   Argentolium[1] (Fran    0(32)
   Rimogne est commune     0(25)
   Respublica Helvetica    0(34)
   Hills Road Sixth For    0(92)
   Aucopolis[1][2] (Ang    0(55)
   Vaprium[1] (-i, n.)     0(48)
   Mirepoix (Gasconice     0(30)
   Volsci[1] populus an    0(16)
   Lantenay est commune    0(33)
   Étouy est commune Fr    0(20)
   Astropecten polyacan    0(21)
   Statoniensis lacus[1    0(46)
   Annus 11 a.C.n. e se    0(11)
   Anna Reagan (Anglice    0(87)
   Saint-Martial-d&#39;Alba    0(25)
   Béla Németh (sive Be    0(17)
   Franciscus Salmhofer    0(42)
   Deversorium Astoria     0(55)
   Concressault est com    0(21)
   Clairfayts est commu    0(29)
</pre></div>
</div>
<p>Ok, what’s this? The mean is zero because the prior mean is always zero. The
standard deviations are all different: should this be the case? Why should the
prior be particularly uncertain about the language score for the wikipedia
introduction to printed electronics? After all, if the mean is zero it means
50-50 whatever the standard deviation. Try to think about the answer, solution
in the footnote <a class="footnote-reference brackets" href="#f2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. Is this a problem? I don’t know. Let’s see what happens.</p>
<p>To use the Gaussian process, I need some other texts which I won’t tell to it
if they are English or Latin. I’ll pick this time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">debellogallico</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Gallia est omnis divisa in partes tres, quarum unam incolunt Belgae,</span>
<span class="s2">    aliam Aquitani, tertiam qui ipsorum lingua Celtae, nostra Galli</span>
<span class="s2">    appellantur. Hi omnes lingua, institutis, legibus inter se differunt.</span>
<span class="s2">    Gallos ab Aquitanis Garumna flumen, a Belgis Matrona et Sequana</span>
<span class="s2">    dividit. Horum omnium fortissimi sunt Belgae, propterea quod a cultu</span>
<span class="s2">    atque humanitate provinciae longissime absunt, minimeque ad eos</span>
<span class="s2">    mercatores saepe commeant atque ea quae ad effeminandos animos</span>
<span class="s2">    pertinent important, proximique sunt Germanis, qui trans Rhenum</span>
<span class="s2">    incolunt, quibuscum continenter bellum gerunt. Qua de causa Helvetii</span>
<span class="s2">    quoque reliquos Gallos virtute praecedunt, quod fere cotidianis</span>
<span class="s2">    proeliis cum Germanis contendunt, cum aut suis finibus eos prohibent</span>
<span class="s2">    aut ipsi in eorum finibus bellum gerunt. Eorum una pars, quam Gallos</span>
<span class="s2">    obtinere dictum est, initium capit a flumine Rhodano, continetur</span>
<span class="s2">    Garumna flumine, Oceano, finibus Belgarum, attingit etiam ab Sequanis</span>
<span class="s2">    et Helvetiis flumen Rhenum, vergit ad septentriones. Belgae ab extremis</span>
<span class="s2">    Galliae finibus oriuntur, pertinent ad inferiorem partem fluminis</span>
<span class="s2">    Rheni, spectant in septentrionem et orientem solem. Aquitania a Garumna</span>
<span class="s2">    flumine ad Pyrenaeos montes et eam partem Oceani quae est ad Hispaniam</span>
<span class="s2">    pertinet; spectat inter occasum solis et septentriones.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">paradiselost</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Of Man&#39;s first disobedience, and the fruit</span>
<span class="s2">    Of that forbidden tree whose mortal taste</span>
<span class="s2">    Brought death into the World, and all our woe,</span>
<span class="s2">    With loss of Eden, till one greater Man</span>
<span class="s2">    Restore us, and regain the blissful seat,</span>
<span class="s2">    Sing, Heavenly Muse, that, on the secret top</span>
<span class="s2">    Of Oreb, or of Sinai, didst inspire</span>
<span class="s2">    That shepherd who first taught the chosen seed</span>
<span class="s2">    In the beginning how the heavens and earth</span>
<span class="s2">    Rose out of Chaos: or, if Sion hill</span>
<span class="s2">    Delight thee more, and Siloa&#39;s brook that flowed</span>
<span class="s2">    Fast by the oracle of God, I thence</span>
<span class="s2">    Invoke thy aid to my adventurous song,</span>
<span class="s2">    That with no middle flight intends to soar</span>
<span class="s2">    Above th&#39; Aonian mount, while it pursues</span>
<span class="s2">    Things unattempted yet in prose or rhyme.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">gp</span> <span class="o">=</span> <span class="p">(</span><span class="n">gp</span>
    <span class="o">.</span><span class="n">addx</span><span class="p">(</span><span class="n">debellogallico</span><span class="p">,</span> <span class="s1">&#39;caesar&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">addx</span><span class="p">(</span><span class="n">paradiselost</span><span class="p">,</span> <span class="s1">&#39;milton&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>To say if a text is English or Latin, we have to give a specific score as data.
Short of better ideas, I’ll use -1 and +1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">post</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">predfromdata</span><span class="p">({</span>
    <span class="s1">&#39;english&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">english_texts</span><span class="p">)),</span>
    <span class="s1">&#39;latin&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">latin_texts</span><span class="p">))</span>
<span class="p">},</span> <span class="p">[</span><span class="s1">&#39;caesar&#39;</span><span class="p">,</span> <span class="s1">&#39;milton&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>This time we passed a list of labels to <a class="reference internal" href="../reference/gp.html#lsqfitgp.GP.predfromdata" title="lsqfitgp.GP.predfromdata"><code class="xref py py-meth docutils literal notranslate"><span class="pre">predfromdata()</span></code></a>, which means
it returns a dictionary with the requested labels as keys. And the posterior
is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;caesar&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;milton&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>5.86042324(59)
-2.4367508(15)
</pre></div>
</div>
<p>It works! The standard deviations are very small compared to the values, so the
probabilities of the sign are almost exactly 100 % (as a rule of thumb, a
Gaussian distribution has negligible mass farther than 5 standard deviations
from the mean).</p>
<p>Is it reasonable that it gets a completely determined result by just counting
the letters? In general different languages will tend to use more some letters.
Here the difference is stark, because in Latin there are no j, k, w, x, y at
all.</p>
<p>However, there’s something that should bother you: the standard deviations are
not just small, they are <em>very</em> small. They’re so small that they seem just an
artefact of the finite precision of floating point computation. Effectively, it
is so: the correct theorical value of those standard deviations is zero. The
reason is that we have fit 50 texts with a kernel that uses 26 letters. In
<a class="reference internal" href="kernels.html#kernelexpl"><span class="std std-ref">More on kernels</span></a> we said that fitting with a kernel <span class="math notranslate nohighlight">\(\sum_i h_i(x)
h_i(x')\)</span> is equivalent to doing a linear least squares fit with parameters
<span class="math notranslate nohighlight">\(p_i\)</span> where the model function is <span class="math notranslate nohighlight">\(\sum_i p_i h_i(x)\)</span>, so we have
more data than parameters. This would not be a problem <em>if we had errors on the
datapoints</em>, but we put in the -1 and +1 without errors, so it’s like solving
a system of 50 equations for 26 variables.</p>
<p>What are the output numbers then, if the fit is apparently not doable? In this
case <a class="reference internal" href="../index.html#module-lsqfitgp" title="lsqfitgp"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lsqfitgp</span></code></a> does something internally which is equivalent to adding a
very small uniform error to the datapoints. This is how the fit is solved, and
it is also why we get a very small but non-zero error on the output.</p>
<p>Now to another matter. In the end, it was not a problem that the prior
variances where depending on the length of the text. But still it feels wrong,
we initially stated the problem as determining if a text is English, not if it
is <em>a lot of</em> English. We set the datapoints to +1 and -1, Milton comes out as
roughly -2, while Caesar is +6. So Caesar is… very Latin?</p>
<p>We can fix this by normalizing the kernel such that the variance is always one.
It is like replacing a covariance matrix with a correlation matrix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gp</span> <span class="o">=</span> <span class="n">lgp</span><span class="o">.</span><span class="n">GP</span><span class="p">(</span><span class="n">CountLetters</span><span class="p">()</span><span class="o">.</span><span class="n">linop</span><span class="p">(</span><span class="s1">&#39;normalize&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
<p>We used the <a class="reference internal" href="../reference/kernel.html#lsqfitgp.CrossKernel.transf" title="lsqfitgp.CrossKernel.transf"><code class="xref py py-obj docutils literal notranslate"><span class="pre">transf</span></code></a> method of <a class="reference internal" href="../reference/kernel.html#lsqfitgp.Kernel" title="lsqfitgp.Kernel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Kernel</span></code></a> objects. It provides
various predefined transformations. Now let’s run the fit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gp</span> <span class="o">=</span> <span class="p">(</span><span class="n">gp</span>
    <span class="o">.</span><span class="n">addx</span><span class="p">(</span><span class="n">english_texts</span><span class="p">,</span> <span class="s1">&#39;english&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">addx</span><span class="p">(</span><span class="n">latin_texts</span><span class="p">,</span> <span class="s1">&#39;latin&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">addx</span><span class="p">(</span><span class="n">debellogallico</span><span class="p">,</span> <span class="s1">&#39;caesar&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">addx</span><span class="p">(</span><span class="n">paradiselost</span><span class="p">,</span> <span class="s1">&#39;milton&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">post</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">predfromdata</span><span class="p">({</span>
    <span class="s1">&#39;english&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">english_texts</span><span class="p">)),</span>
    <span class="s1">&#39;latin&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">latin_texts</span><span class="p">))</span>
<span class="p">},</span> <span class="p">[</span><span class="s1">&#39;caesar&#39;</span><span class="p">,</span> <span class="s1">&#39;milton&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&#39;caesar&#39;: array(0.7295438278(95), dtype=object), &#39;milton&#39;: array(-1.268045911(13), dtype=object)}
</pre></div>
</div>
<p>This time both means are close to ±1.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The technique of using -1 and +1 to map a binary variable to continuous
values for regression works fine in this simple example but is in general
poor.</p>
</div>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>It’s the length. The printed electronics paragraph is the longest,
and in general the Latin ones were shorter.</p>
</aside>
</aside>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="integrals.html" title="Previous document"><span class="section-number">5. </span>Taking integrals</a>
        </li>
        <li>
          <a href="in.html" title="Next document"><span class="section-number">7. </span>Multidimensional input</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2020-2024, Giacomo Petrillo.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/userguide/customs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>