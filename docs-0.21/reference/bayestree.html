<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>BART &#8212; lsqfitgp 0.21 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=f6a572b4" />
    <script src="../_static/documentation_options.js?v=a53c679b"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Gvar extensions" href="gvarext.html" />
    <link rel="prev" title="Gaussian copulas" href="copula.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">lsqfitgp 0.21</a></h1>



<p class="blurb">A general purpose Gaussian process regression module</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=Gattocrucco&repo=lsqfitgp&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../userguide/userguide.html">Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="reference.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="kernelsref.html">Predefined kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel.html">Generic kernel classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="kerneldec.html">Kernel decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernelop.html">Kernel transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="deriv.html">Derivative specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="gp.html">Gaussian process class</a></li>
<li class="toctree-l2"><a class="reference internal" href="array.html">Structured arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="fit.html">Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="raniter.html">Random sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="copula.html">Gaussian copulas</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">BART</a></li>
<li class="toctree-l2"><a class="reference internal" href="gvarext.html">Gvar extensions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examplesref.html">Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/development.html">Development</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="reference.html">Reference</a><ul>
      <li>Previous: <a href="copula.html" title="previous chapter">Gaussian copulas</a></li>
      <li>Next: <a href="gvarext.html" title="next chapter">Gvar extensions</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="copula.html" title="Previous document">Gaussian copulas</a>
        </li>
        <li>
          <a href="gvarext.html" title="Next document">Gvar extensions</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="bart">
<span id="module-lsqfitgp.bayestree"></span><h1>BART<a class="headerlink" href="#bart" title="Link to this heading">¶</a></h1>
<p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">bayestree</span></code> submodule contains classes to set up a Gaussian process
regression with the <a class="reference internal" href="kernelsref.html#lsqfitgp.BART" title="lsqfitgp.BART"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BART</span></code></a> kernel. See the <a class="reference internal" href="../examplesref.html#bart"><span class="std std-ref">bart</span></a>,
<a class="reference internal" href="../examplesref.html#barteasy"><span class="std std-ref">barteasy</span></a> and <a class="reference internal" href="../examplesref.html#bcf"><span class="std std-ref">bcf</span></a> examples.</p>
<p>The original version of these models is implemented in the R packages <a class="reference external" href="https://cran.r-project.org/package=BART">BART</a>, <a class="reference external" href="https://cran.r-project.org/package=dbarts">dbarts</a>, and <a class="reference external" href="https://cran.r-project.org/package=bcf">bcf</a>. Pros of the GP version provided
here:</p>
<blockquote>
<div><ul class="simple">
<li><p>No MCMC, the result is computed quite directly.</p></li>
<li><p>Fast inference on the hyperparameters.</p></li>
<li><p>Allows a wider region of hyperparameter space.</p></li>
</ul>
</div></blockquote>
<p>Cons:</p>
<blockquote>
<div><ul class="simple">
<li><p>Does not scale to large datasets.</p></li>
<li><p>Worse predictive performance at fixed hyperparameters.</p></li>
<li><p>Slower at fixed hyperparameters.</p></li>
<li><p>May use more memory.</p></li>
</ul>
</div></blockquote>
<p>Overall, this version should typically be a better choice than the R packages if
you have at most 10000 datapoints.</p>
<section id="index">
<h2>Index<a class="headerlink" href="#index" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="#lsqfitgp.bayestree.bart" title="lsqfitgp.bayestree.bart"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bart</span></code></a>, <a class="reference internal" href="#lsqfitgp.bayestree.bcf" title="lsqfitgp.bayestree.bcf"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bcf</span></code></a></p>
</section>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="lsqfitgp.bayestree.bart">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lsqfitgp.bayestree.</span></span><span class="sig-name descname"><span class="pre">bart</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitkw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernelkw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marginalize_mean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/Gattocrucco/lsqfitgp/blob/v0.21/src/lsqfitgp/bayestree/_bart.py#L38-L464"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lsqfitgp.bayestree.bart" title="Link to this definition">¶</a></dt>
<dd><p>Nonparametric Bayesian regression with a GP version of BART.</p>
<p>Evaluate a Gaussian process regression with a kernel which accurately
approximates the infinite trees limit of BART. The hyperparameters are
optimized to their marginal MAP.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>x_train</strong><span class="classifier">(n, p) array or dataframe</span></dt><dd><p>Observed covariates.</p>
</dd>
<dt><strong>y_train</strong><span class="classifier">(n,) array</span></dt><dd><p>Observed outcomes.</p>
</dd>
<dt><strong>weights</strong><span class="classifier">(n,) array</span></dt><dd><p>Weights used to rescale the error variance (as 1 / weight).</p>
</dd>
<dt><strong>fitkw</strong><span class="classifier">dict</span></dt><dd><p>Additional arguments passed to <a class="reference internal" href="fit.html#lsqfitgp.empbayes_fit" title="lsqfitgp.empbayes_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">empbayes_fit</span></code></a>, overrides
the defaults.</p>
</dd>
<dt><strong>kernelkw</strong><span class="classifier">dict</span></dt><dd><p>Additional arguments passed to <a class="reference internal" href="kernelsref.html#lsqfitgp.BART" title="lsqfitgp.BART"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BART</span></code></a>, overrides the
defaults.</p>
</dd>
<dt><strong>marginalize_mean</strong><span class="classifier">bool</span></dt><dd><p>If True (default), marginalize the intercept of the model.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Attributes<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>mean</strong><span class="classifier">gvar</span></dt><dd><p>The prior mean <span class="math notranslate nohighlight">\(\mu\)</span>.</p>
</dd>
<dt><strong>sigma</strong><span class="classifier">float or gvar</span></dt><dd><p>The error term standard deviation <span class="math notranslate nohighlight">\(\sigma\)</span>. If there are
weights, the sdev for each unit is obtained dividing <code class="docutils literal notranslate"><span class="pre">sigma</span></code> by
sqrt(weight).</p>
</dd>
<dt><strong>alpha</strong><span class="classifier">gvar</span></dt><dd><p>The numerator of the tree spawn probability <span class="math notranslate nohighlight">\(\alpha\)</span> (named
<code class="docutils literal notranslate"><span class="pre">base</span></code> in BayesTree and BART).</p>
</dd>
<dt><strong>beta</strong><span class="classifier">gvar</span></dt><dd><p>The depth exponent of the tree spawn probability <span class="math notranslate nohighlight">\(\beta\)</span>
(named <code class="docutils literal notranslate"><span class="pre">power</span></code> in BayesTree and BART).</p>
</dd>
<dt><strong>meansdev</strong><span class="classifier">gvar</span></dt><dd><p>The prior standard deviation <span class="math notranslate nohighlight">\(\lambda\)</span> of the latent
regression function.</p>
</dd>
<dt><strong>fit</strong><span class="classifier">empbayes_fit</span></dt><dd><p>The hyperparameters fit object.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Methods</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#lsqfitgp.bayestree.bart.gp" title="lsqfitgp.bayestree.bart.gp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gp</span></code></a>(*[, hp, x_test, weights, rng])</p></td>
<td><p>Create a Gaussian process with the fitted hyperparameters.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#lsqfitgp.bayestree.bart.data" title="lsqfitgp.bayestree.bart.data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code></a>(*[, hp, rng])</p></td>
<td><p>Get the data to be passed to <code class="xref py py-obj docutils literal notranslate"><span class="pre">GP.pred</span></code> on a GP object returned by <a class="reference internal" href="#lsqfitgp.bayestree.bart.gp" title="lsqfitgp.bayestree.bart.gp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gp</span></code></a>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#lsqfitgp.bayestree.bart.pred" title="lsqfitgp.bayestree.bart.pred"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pred</span></code></a>(*[, hp, error, format, x_test, ...])</p></td>
<td><p>Predict the outcome at given locations.</p></td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="kernelsref.html#lsqfitgp.BART" title="lsqfitgp.BART"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lsqfitgp.BART</span></code></a></dt><dd></dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p>The regression model is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}y_i &amp;= \mu + \lambda f(\mathbf x_i) + \varepsilon_i, \\
\varepsilon_i &amp;\overset{\mathrm{i.i.d.}}{\sim}
    N(0, \sigma^2 / w_i), \\
\mu &amp;\sim N(
    (\max(\mathbf y) + \min(\mathbf y)) / 2,
    (\max(\mathbf y) - \min(\mathbf y))^2 / 4
), \\
\log \sigma^2 &amp;\sim N(
    \log(\overline{w(y - \bar y)^2}),
    4
), \\
\log \lambda &amp;\sim N(
    \log ((\max(\mathbf y) - \min(\mathbf y)) / 4),
    4
), \\
f &amp;\sim \mathrm{GP}(
    0,
    \mathrm{BART}(\alpha,\beta)
), \\
\alpha &amp;\sim \mathrm{B}(2, 1), \\
\beta &amp;\sim \mathrm{IG}(1, 1).\end{split}\]</div>
<p>To make the inference, <span class="math notranslate nohighlight">\((f, \boldsymbol\varepsilon, \mu)\)</span> are
marginalized analytically, and the marginal posterior mode of
<span class="math notranslate nohighlight">\((\sigma, \lambda, \alpha, \beta)\)</span> is found by numerical
minimization, after transforming them to express their prior as a
Gaussian copula. Their marginal posterior covariance matrix is estimated
with an approximation of the hessian inverse. See
<a class="reference internal" href="fit.html#lsqfitgp.empbayes_fit" title="lsqfitgp.empbayes_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">empbayes_fit</span></code></a> and use the parameter <code class="docutils literal notranslate"><span class="pre">fitkw</span></code> to customize
this procedure.</p>
<p>The tree splitting grid of the BART kernel is set using quantiles of the
observed covariates. This corresponds to settings <code class="docutils literal notranslate"><span class="pre">usequants=True</span></code>,
<code class="docutils literal notranslate"><span class="pre">numcut=inf</span></code> in the R packages BayesTree and BART. Use the
<code class="docutils literal notranslate"><span class="pre">kernelkw</span></code> parameter to customize the grid.</p>
<dl class="py method">
<dt class="sig sig-object py" id="lsqfitgp.bayestree.bart.data">
<span class="sig-name descname"><span class="pre">data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/Gattocrucco/lsqfitgp/blob/v0.21/src/lsqfitgp/bayestree/_bart.py#L316-L337"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lsqfitgp.bayestree.bart.data" title="Link to this definition">¶</a></dt>
<dd><p>Get the data to be passed to <code class="xref py py-obj docutils literal notranslate"><span class="pre">GP.pred</span></code> on a GP object returned by <a class="reference internal" href="#lsqfitgp.bayestree.bart.gp" title="lsqfitgp.bayestree.bart.gp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gp</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>hp</strong><span class="classifier">str or dict</span></dt><dd><p>The hyperparameters to use. If <code class="docutils literal notranslate"><span class="pre">'map'</span></code>, use the marginal maximum a
posteriori. If <code class="docutils literal notranslate"><span class="pre">'sample'</span></code>, sample hyperparameters from the
posterior. If a dict, use the given hyperparameters.</p>
</dd>
<dt><strong>rng</strong><span class="classifier">numpy.random.Generator, optional</span></dt><dd><p>Random number generator, used if <code class="docutils literal notranslate"><span class="pre">hp</span> <span class="pre">==</span> <span class="pre">'sample'</span></code>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>data</strong><span class="classifier">dict</span></dt><dd><p>A dictionary representing <code class="docutils literal notranslate"><span class="pre">y_train</span></code> in the format required by the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">GP.pred</span></code> method.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lsqfitgp.bayestree.bart.gp">
<span class="sig-name descname"><span class="pre">gp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/Gattocrucco/lsqfitgp/blob/v0.21/src/lsqfitgp/bayestree/_bart.py#L255-L282"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lsqfitgp.bayestree.bart.gp" title="Link to this definition">¶</a></dt>
<dd><p>Create a Gaussian process with the fitted hyperparameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>hp</strong><span class="classifier">str or dict</span></dt><dd><p>The hyperparameters to use. If <code class="docutils literal notranslate"><span class="pre">'map'</span></code>, use the marginal maximum a
posteriori. If <code class="docutils literal notranslate"><span class="pre">'sample'</span></code>, sample hyperparameters from the
posterior. If a dict, use the given hyperparameters.</p>
</dd>
<dt><strong>x_test</strong><span class="classifier">array or dataframe, optional</span></dt><dd><p>Additional covariates for “test points”.</p>
</dd>
<dt><strong>weights</strong><span class="classifier">array, optional</span></dt><dd><p>Weights for the error variance on the test points.</p>
</dd>
<dt><strong>rng</strong><span class="classifier">numpy.random.Generator, optional</span></dt><dd><p>Random number generator, used if <code class="docutils literal notranslate"><span class="pre">hp</span> <span class="pre">==</span> <span class="pre">'sample'</span></code>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>gp</strong><span class="classifier">GP</span></dt><dd><p>A centered Gaussian process object. To add the mean, use the
<code class="docutils literal notranslate"><span class="pre">mean</span></code> attribute of the <a class="reference internal" href="#lsqfitgp.bayestree.bart" title="lsqfitgp.bayestree.bart"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bart</span></code></a> object. The keys of the GP are
‘Xmean’, ‘Xnoise’, and ‘X’, where the “X” stands either for ‘train’
or ‘test’, and X = Xmean + Xnoise.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lsqfitgp.bayestree.bart.pred">
<span class="sig-name descname"><span class="pre">pred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'matrices'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/Gattocrucco/lsqfitgp/blob/v0.21/src/lsqfitgp/bayestree/_bart.py#L339-L392"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lsqfitgp.bayestree.bart.pred" title="Link to this definition">¶</a></dt>
<dd><p>Predict the outcome at given locations.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>hp</strong><span class="classifier">str or dict</span></dt><dd><p>The hyperparameters to use. If <code class="docutils literal notranslate"><span class="pre">'map'</span></code>, use the marginal maximum a
posteriori. If <code class="docutils literal notranslate"><span class="pre">'sample'</span></code>, sample hyperparameters from the
posterior. If a dict, use the given hyperparameters.</p>
</dd>
<dt><strong>error</strong><span class="classifier">bool</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">False</span></code> (default), make a prediction for the latent mean. If
<code class="docutils literal notranslate"><span class="pre">True</span></code>, add the error term.</p>
</dd>
<dt><strong>format</strong><span class="classifier">{‘matrices’, ‘gvar’}</span></dt><dd><p>If ‘matrices’ (default), return the mean and covariance matrix
separately. If ‘gvar’, return an array of gvars.</p>
</dd>
<dt><strong>x_test</strong><span class="classifier">array or dataframe, optional</span></dt><dd><p>Covariates for the locations where the prediction is computed. If
not specified, predict at the data covariates.</p>
</dd>
<dt><strong>weights</strong><span class="classifier">array, optional</span></dt><dd><p>Weights for the error variance on the test points.</p>
</dd>
<dt><strong>rng</strong><span class="classifier">numpy.random.Generator, optional</span></dt><dd><p>Random number generator, used if <code class="docutils literal notranslate"><span class="pre">hp</span> <span class="pre">==</span> <span class="pre">'sample'</span></code>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl>
<dt>If <code class="docutils literal notranslate"><span class="pre">format</span></code> is ‘matrices’ (default):</dt><dd></dd>
<dt><strong>mean, cov</strong><span class="classifier">arrays</span></dt><dd><p>The mean and covariance matrix of the Normal posterior distribution
over the regression function at the specified locations.</p>
</dd>
<dt>If <code class="docutils literal notranslate"><span class="pre">format</span></code> is ‘gvar’:</dt><dd></dd>
<dt><strong>out</strong><span class="classifier">array of <code class="xref py py-obj docutils literal notranslate"><span class="pre">GVar</span></code></span></dt><dd><p>The same distribution represented as an array of <code class="xref py py-obj docutils literal notranslate"><span class="pre">GVar</span></code> objects.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<hr class="docutils" />
<dl class="py class">
<dt class="sig sig-object py" id="lsqfitgp.bayestree.bcf">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">lsqfitgp.bayestree.</span></span><span class="sig-name descname"><span class="pre">bcf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_mu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_tau</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pihat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_pi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitkw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernelkw_mu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernelkw_tau</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marginalize_mean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gpaux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_aux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">otherhp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'standardize'</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/Gattocrucco/lsqfitgp/blob/v0.21/src/lsqfitgp/bayestree/_bcf.py#L91-L1097"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lsqfitgp.bayestree.bcf" title="Link to this definition">¶</a></dt>
<dd><p>Nonparametric Bayesian regression with a GP version of BCF.</p>
<p>BCF (Bayesian Causal Forests) is a regression method for observational
causal inference studies introduced in <a class="reference internal" href="#r81cef080e874-1" id="id2">[1]</a> based on a pair of BART
models.</p>
<p>This class evaluates a Gaussian process regression with a kernel which
accurately approximates BCF in the infinite trees limit of each BART
model. The hyperparameters are optimized to their marginal MAP.</p>
<p>The model is (loosely, see notes below) <span class="math notranslate nohighlight">\(y = \mu(x) + z\tau(x)\)</span>,
so <span class="math notranslate nohighlight">\(\tau(x)\)</span> is the expected causal effect of <span class="math notranslate nohighlight">\(z\)</span> on
<span class="math notranslate nohighlight">\(y\)</span> at location <span class="math notranslate nohighlight">\(x\)</span>.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>y</strong><span class="classifier">(n,) array, series or dataframe</span></dt><dd><p>Outcome.</p>
</dd>
<dt><strong>z</strong><span class="classifier">(n,) array, series or dataframe</span></dt><dd><p>Binary treatment status: 0 control group, 1 treatment group.</p>
</dd>
<dt><strong>x_mu</strong><span class="classifier">(n, p) array, series or dataframe</span></dt><dd><p>Covariates for the <span class="math notranslate nohighlight">\(\mu\)</span> model.</p>
</dd>
<dt><strong>x_tau</strong><span class="classifier">(n, q) array, series or dataframe, optional</span></dt><dd><p>Covariates for the <span class="math notranslate nohighlight">\(\tau\)</span> model. If not specified, use <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_mu</span></code>.</p>
</dd>
<dt><strong>pihat</strong><span class="classifier">(n,) array, series or dataframe</span></dt><dd><p>Estimated propensity score, i.e., P(Z=1|X).</p>
</dd>
<dt><strong>include_pi</strong><span class="classifier">{‘mu’, ‘tau’, ‘both’}, optional</span></dt><dd><p>Whether to include the propensity score in the <span class="math notranslate nohighlight">\(\mu\)</span> model,
the <span class="math notranslate nohighlight">\(\tau\)</span> model, or both. Default is <code class="docutils literal notranslate"><span class="pre">'mu'</span></code>.</p>
</dd>
<dt><strong>weights</strong><span class="classifier">(n,) array, series or dataframe</span></dt><dd><p>Weights used to rescale the error variance (as 1 / weight).</p>
</dd>
<dt><strong>fitkw</strong><span class="classifier">dict</span></dt><dd><p>Additional arguments passed to <a class="reference internal" href="fit.html#lsqfitgp.empbayes_fit" title="lsqfitgp.empbayes_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">empbayes_fit</span></code></a>, overrides
the defaults.</p>
</dd>
<dt><strong>kernelkw_mu, kernelkw_tau</strong><span class="classifier">dict</span></dt><dd><p>Additional arguments passed to <a class="reference internal" href="kernelsref.html#lsqfitgp.BART" title="lsqfitgp.BART"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BART</span></code></a> for each model,
overrides the defaults.</p>
</dd>
<dt><strong>marginalize_mean</strong><span class="classifier">bool</span></dt><dd><p>If True (default), marginalize the intercept of the model.</p>
</dd>
<dt><strong>gpaux</strong><span class="classifier">callable, optional</span></dt><dd><p>If specified, this function is called with a pair <code class="docutils literal notranslate"><span class="pre">(hp,</span> <span class="pre">gp)</span></code>,
where <code class="docutils literal notranslate"><span class="pre">hp</span></code> is a dictionary of hyperparameters, and <code class="docutils literal notranslate"><span class="pre">gp</span></code> is a
<a class="reference internal" href="gp.html#lsqfitgp.GP" title="lsqfitgp.GP"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GP</span></code></a> object under construction, and is expected to return
a modified <code class="docutils literal notranslate"><span class="pre">gp</span></code> with a new process named <code class="docutils literal notranslate"><span class="pre">'aux'</span></code> defined with
<a class="reference internal" href="gp.html#lsqfitgp.GP.defproc" title="lsqfitgp.GP.defproc"><code class="xref py py-obj docutils literal notranslate"><span class="pre">defproc</span></code></a> or similar. The process is added to the
regression model. The input to the process is a structured array
with fields:</p>
<dl class="simple">
<dt>‘train’<span class="classifier">bool</span></dt><dd><p>Indicates whether the data is training set (the one passed on
initialization) or test set (the one passed to <a class="reference internal" href="#lsqfitgp.bayestree.bcf.pred" title="lsqfitgp.bayestree.bcf.pred"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pred</span></code></a> or <a class="reference internal" href="#lsqfitgp.bayestree.bcf.gp" title="lsqfitgp.bayestree.bcf.gp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gp</span></code></a>).</p>
</dd>
<dt>‘i’<span class="classifier">int</span></dt><dd><p>Index of the flattened array.</p>
</dd>
<dt>‘z’<span class="classifier">int</span></dt><dd><p>Treatment status.</p>
</dd>
<dt>‘mu’, ‘tau’<span class="classifier">structured</span></dt><dd><p>The values in <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_mu</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_tau</span></code>, converted to indices according
to the BART grids. Where <code class="xref py py-obj docutils literal notranslate"><span class="pre">pihat</span></code> has been added, there are two
subfields: <code class="docutils literal notranslate"><span class="pre">'x'</span></code> which contains the covariates, and
<code class="docutils literal notranslate"><span class="pre">'pihat'</span></code>, the latter expressed in indices as well.</p>
</dd>
<dt>‘pihat’<span class="classifier">float</span></dt><dd><p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">pihat</span></code> argument. Contrary to the subfield included under
<code class="docutils literal notranslate"><span class="pre">'mu'</span></code> and/or <code class="docutils literal notranslate"><span class="pre">'tau'</span></code>, this field contains the original
values.</p>
</dd>
<dt>‘aux’<span class="classifier">structured</span></dt><dd><p>The values in <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_aux</span></code>, if specified.</p>
</dd>
</dl>
</dd>
<dt><strong>x_aux</strong><span class="classifier">(n, k) array, series or dataframe, optional</span></dt><dd><p>Additional covariates for the <code class="docutils literal notranslate"><span class="pre">'aux'</span></code> process.</p>
</dd>
<dt><strong>otherhp</strong><span class="classifier">dictionary of gvar</span></dt><dd><p>A dictionary with the prior of arbitrary additional hyperpameters,
intended to be used by <code class="docutils literal notranslate"><span class="pre">gpaux</span></code> or <code class="docutils literal notranslate"><span class="pre">transf</span></code>.</p>
</dd>
<dt><strong>transf</strong><span class="classifier">(list of) str or pair of callable</span></dt><dd><p>Data transformation. Either a string indicating a pre-defined
transformation, or a pair <code class="docutils literal notranslate"><span class="pre">(from_data,</span> <span class="pre">to_data)</span></code>, two functions
with signatures <code class="docutils literal notranslate"><span class="pre">from_data(hp,</span> <span class="pre">y)</span> <span class="pre">-&gt;</span> <span class="pre">eta</span></code> and <code class="docutils literal notranslate"><span class="pre">to_data(hp,</span> <span class="pre">eta)</span>
<span class="pre">-&gt;</span> <span class="pre">y</span></code>, where <code class="docutils literal notranslate"><span class="pre">eta</span></code> is the value to which the model is fit, and
<code class="docutils literal notranslate"><span class="pre">hp</span></code> is the dictionary of hyperparameters. The functions must be
ufuncs and one the inverse of the other w.r.t. the second parameter.
<code class="docutils literal notranslate"><span class="pre">from_data</span></code> must be derivable with <code class="xref py py-obj docutils literal notranslate"><span class="pre">jax</span></code> w.r.t. <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<p>If a list of such specifications is provided, the transformations
are applied in order, with the first one being the outermost, i.e.,
the one applied first to the data.</p>
<p>If a transformation uses additional hyperparameters, either
predefined automatically or passed by the user through <code class="xref py py-obj docutils literal notranslate"><span class="pre">otherhp</span></code>,
they are inferred with the rest of the hyperparameters.</p>
<p>The pre-defined transformations are:</p>
<dl class="simple">
<dt>‘standardize’ (default)</dt><dd><p>eta = (y - mean(train_y)) / sdev(train_y)</p>
</dd>
<dt>‘yeojohnson’</dt><dd><p>The Yeo-Johnson transformation <a class="reference internal" href="#r81cef080e874-2" id="id3">[2]</a> to reduce skewness. The
<span class="math notranslate nohighlight">\(\lambda\)</span> parameter is bounded in <span class="math notranslate nohighlight">\((0, 2)\)</span>
for implementation convenience, this restriction may be lifted
in future versions.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt class="field-even">Attributes<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>m</strong><span class="classifier">float or gvar</span></dt><dd><p>The prior mean <span class="math notranslate nohighlight">\(m\)</span>.</p>
</dd>
<dt><strong>sigma</strong><span class="classifier">gvar</span></dt><dd><p>The error term standard deviation <span class="math notranslate nohighlight">\(\sigma\)</span>. If there are
weights, the sdev for each unit is obtained dividing <code class="docutils literal notranslate"><span class="pre">sigma</span></code> by
sqrt(weight).</p>
</dd>
<dt><strong>alpha_mu, alpha_tau</strong><span class="classifier">gvar</span></dt><dd><p>The numerator of the tree spawn probability <span class="math notranslate nohighlight">\(\alpha_*\)</span> (named
<code class="docutils literal notranslate"><span class="pre">base</span></code> in R bcf).</p>
</dd>
<dt><strong>beta_mu, beta_tau</strong><span class="classifier">gvar</span></dt><dd><p>The depth exponent of the tree spawn probability <span class="math notranslate nohighlight">\(\beta_*\)</span>
(named <code class="docutils literal notranslate"><span class="pre">power</span></code> in R bcf).</p>
</dd>
<dt><strong>lambda_mu, lambda_tau</strong><span class="classifier">gvar</span></dt><dd><p>The prior standard deviation <span class="math notranslate nohighlight">\(\lambda_*\)</span>.</p>
</dd>
<dt><strong>z_0</strong><span class="classifier">gvar</span></dt><dd><p>The treatment coding parameter.</p>
</dd>
<dt><strong>fit</strong><span class="classifier">empbayes_fit</span></dt><dd><p>The hyperparameters fit object.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Methods</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#lsqfitgp.bayestree.bcf.gp" title="lsqfitgp.bayestree.bcf.gp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gp</span></code></a>(*[, hp, z, x_mu, x_tau, pihat, x_aux, ...])</p></td>
<td><p>Create a Gaussian process with the fitted hyperparameters.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#lsqfitgp.bayestree.bcf.data" title="lsqfitgp.bayestree.bcf.data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code></a>(*[, hp, rng])</p></td>
<td><p>Get the data to be passed to <code class="xref py py-obj docutils literal notranslate"><span class="pre">GP.pred</span></code> on a GP object returned by <a class="reference internal" href="#lsqfitgp.bayestree.bcf.gp" title="lsqfitgp.bayestree.bcf.gp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gp</span></code></a>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#lsqfitgp.bayestree.bcf.pred" title="lsqfitgp.bayestree.bcf.pred"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pred</span></code></a>(*[, hp, error, z, x_mu, x_tau, pihat, ...])</p></td>
<td><p>Predict the transformed outcome at given locations.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#lsqfitgp.bayestree.bcf.from_data" title="lsqfitgp.bayestree.bcf.from_data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">from_data</span></code></a>(y, *[, hp, rng])</p></td>
<td><p>Transforms outcomes <span class="math notranslate nohighlight">\(y\)</span> to the regression variable <span class="math notranslate nohighlight">\(\eta\)</span>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#lsqfitgp.bayestree.bcf.to_data" title="lsqfitgp.bayestree.bcf.to_data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_data</span></code></a>(eta, *[, hp, rng])</p></td>
<td><p>Convert the regression variable <span class="math notranslate nohighlight">\(\eta\)</span> to outcomes <span class="math notranslate nohighlight">\(y\)</span>.</p></td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="kernelsref.html#lsqfitgp.BART" title="lsqfitgp.BART"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lsqfitgp.BART</span></code></a></dt><dd></dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p>The regression model is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\eta_i = g(y_i; \ldots) &amp;= m + {} \\
    &amp;\phantom{{}={}} +
        \lambda_\mu
        \mu(\mathbf x^\mu_i, \hat\pi_i?) + {} \\
    &amp;\phantom{{}={}} +
        \lambda_\tau
        \tau(\mathbf x^\tau_i, \hat\pi_i?) (z_i - z_0) + {} \\
    &amp;\phantom{{}={}} +
        \mathrm{aux}(i, z_i, \mathbf x^\mu_i, \mathbf x^\tau_i,
            \hat\pi_i, \mathbf x^\text{aux}_i) + {} \\
    &amp;\phantom{{}={}} +
        \varepsilon_i, \\
\varepsilon_i &amp;\sim
    N(0, \sigma^2 / w_i), \\
m &amp;\sim N(0, 1), \\
\log \sigma^2 &amp;\sim N(\log\bar w, 4), \\
\lambda_\mu
    &amp;\sim \mathrm{HalfCauchy}(2), \\
\lambda_\tau
    &amp;\sim \mathrm{HalfNormal}(1.48), \\
\mu &amp;\sim \mathrm{GP}(0,
    \mathrm{BART}(\alpha_\mu, \beta_\mu) ), \\
\tau &amp;\sim \mathrm{GP}(0,
    \mathrm{BART}(\alpha_\tau, \beta_\tau) ), \\
\mathrm{aux} &amp; \sim \mathrm{GP}(0, \text{&lt;user defined&gt;}), \\
\alpha_\mu, \alpha_\tau &amp;\sim \mathrm{Beta}(2, 1), \\
\beta_\mu, \beta_\tau &amp;\sim \mathrm{InvGamma}(1, 1), \\
z_0 &amp;\sim U(0, 1),\end{split}\]</div>
<p>To make the inference, <span class="math notranslate nohighlight">\((\mu, \tau, \boldsymbol\varepsilon, m,
\mathrm{aux})\)</span> are marginalized analytically, and the marginal posterior
mode of
<span class="math notranslate nohighlight">\((\sigma, \lambda_*, \alpha_*, \beta_*, z_0, \ldots)\)</span> is found by
numerical minimization, after transforming them to express their prior
as a Gaussian copula. Their marginal posterior covariance matrix is
estimated with an approximation of the hessian inverse. See
<a class="reference internal" href="fit.html#lsqfitgp.empbayes_fit" title="lsqfitgp.empbayes_fit"><code class="xref py py-obj docutils literal notranslate"><span class="pre">empbayes_fit</span></code></a> and use the parameter <code class="docutils literal notranslate"><span class="pre">fitkw</span></code> to customize
this procedure.</p>
<p>The tree splitting grid of the BART kernel is set using quantiles of the
observed covariates. This corresponds to settings <code class="docutils literal notranslate"><span class="pre">usequants=True</span></code>,
<code class="docutils literal notranslate"><span class="pre">numcut=inf</span></code> in the R packages BayesTree and BART. Use the parameters
<code class="xref py py-obj docutils literal notranslate"><span class="pre">kernelkw_mu</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">kernelkw_tau</span></code> to customize the grids.</p>
<p>The difference between the regression model evaluated at <span class="math notranslate nohighlight">\(Z=1\)</span> vs.
<span class="math notranslate nohighlight">\(Z=0\)</span> can be interpreted as the causal effect <span class="math notranslate nohighlight">\(Z \rightarrow
Y\)</span> if the unconfoundedness assumption is made:</p>
<div class="math notranslate nohighlight">
\[\{Y(Z=0), Y(Z=1)\} \perp\!\!\!\perp Z \mid X.\]</div>
<p>In practical terms, this holds when:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\(X\)</span> are pre-treatment variables, i.e., they represent
quantities causally upstream of <span class="math notranslate nohighlight">\(Z\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(X\)</span> are sufficient to adjust for all common causes of
<span class="math notranslate nohighlight">\(Z\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>, such that the only remaining difference
is the causal effect and not just a correlation.</p></li>
</ol>
</div></blockquote>
<p>Here <span class="math notranslate nohighlight">\(X\)</span> consists in <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_tau</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_mu</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_aux</span></code>. However these
arrays may also be used to pass “technical” values used to set up the
model, that do not satisfy the uncounfoundedness assumption, if you know
what you are doing.</p>
<p class="rubric">References</p>
<div role="list" class="citation-list">
<div class="citation" id="r81cef080e874-1" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p>P. Richard Hahn, Jared S. Murray, Carlos M. Carvalho “Bayesian
Regression Tree Models for Causal Inference: Regularization,
Confounding, and Heterogeneous Effects (with Discussion),” Bayesian
Analysis 15(3), 965-1056, September 2020,
<a class="reference external" href="https://doi.org/10.1214/19-BA1195">https://doi.org/10.1214/19-BA1195</a></p>
</div>
<div class="citation" id="r81cef080e874-2" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p>Yeo, In-Kwon; Johnson, Richard A. (2000). “A New Family of Power
Transformations to Improve Normality or Symmetry”. Biometrika. 87
(4): 954–959. <a class="reference external" href="https://doi.org/10.1093/biomet/87.4.954">https://doi.org/10.1093/biomet/87.4.954</a></p>
</div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="lsqfitgp.bayestree.bcf.data">
<span class="sig-name descname"><span class="pre">data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/Gattocrucco/lsqfitgp/blob/v0.21/src/lsqfitgp/bayestree/_bcf.py#L673-L694"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lsqfitgp.bayestree.bcf.data" title="Link to this definition">¶</a></dt>
<dd><p>Get the data to be passed to <code class="xref py py-obj docutils literal notranslate"><span class="pre">GP.pred</span></code> on a GP object returned by <a class="reference internal" href="#lsqfitgp.bayestree.bcf.gp" title="lsqfitgp.bayestree.bcf.gp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gp</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>hp</strong><span class="classifier">str or dict</span></dt><dd><p>The hyperparameters to use. If <code class="docutils literal notranslate"><span class="pre">'map'</span></code> (default), use the marginal
maximum a posteriori. If <code class="docutils literal notranslate"><span class="pre">'sample'</span></code>, sample hyperparameters from
the posterior. If a dict, use the given hyperparameters.</p>
</dd>
<dt><strong>rng</strong><span class="classifier">numpy.random.Generator, optional</span></dt><dd><p>Random number generator, used if <code class="docutils literal notranslate"><span class="pre">hp</span> <span class="pre">==</span> <span class="pre">'sample'</span></code>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>data</strong><span class="classifier">dict</span></dt><dd><p>A dictionary representing <code class="docutils literal notranslate"><span class="pre">eta</span></code> in the format required by the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">GP.pred</span></code> method.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lsqfitgp.bayestree.bcf.from_data">
<span class="sig-name descname"><span class="pre">from_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/Gattocrucco/lsqfitgp/blob/v0.21/src/lsqfitgp/bayestree/_bcf.py#L845-L867"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lsqfitgp.bayestree.bcf.from_data" title="Link to this definition">¶</a></dt>
<dd><p>Transforms outcomes <span class="math notranslate nohighlight">\(y\)</span> to the regression variable <span class="math notranslate nohighlight">\(\eta\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>y</strong><span class="classifier">(n,) array</span></dt><dd><p>Outcomes.</p>
</dd>
<dt><strong>hp</strong><span class="classifier">str or dict</span></dt><dd><p>The hyperparameters to use. If <code class="docutils literal notranslate"><span class="pre">'map'</span></code> (default), use the marginal
maximum a posteriori. If <code class="docutils literal notranslate"><span class="pre">'sample'</span></code>, sample hyperparameters from
the posterior. If a dict, use the given hyperparameters.</p>
</dd>
<dt><strong>rng</strong><span class="classifier">numpy.random.Generator, optional</span></dt><dd><p>Random number generator, used if <code class="docutils literal notranslate"><span class="pre">hp</span> <span class="pre">==</span> <span class="pre">'sample'</span></code>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>eta</strong><span class="classifier">(n,) array</span></dt><dd><p>Transformed outcomes.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lsqfitgp.bayestree.bcf.gp">
<span class="sig-name descname"><span class="pre">gp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_mu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_tau</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pihat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_aux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/Gattocrucco/lsqfitgp/blob/v0.21/src/lsqfitgp/bayestree/_bcf.py#L553-L593"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lsqfitgp.bayestree.bcf.gp" title="Link to this definition">¶</a></dt>
<dd><p>Create a Gaussian process with the fitted hyperparameters.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>hp</strong><span class="classifier">str or dict</span></dt><dd><p>The hyperparameters to use. If <code class="docutils literal notranslate"><span class="pre">'map'</span></code> (default), use the marginal
maximum a posteriori. If <code class="docutils literal notranslate"><span class="pre">'sample'</span></code>, sample hyperparameters from
the posterior. If a dict, use the given hyperparameters.</p>
</dd>
<dt><strong>z</strong><span class="classifier">(m,) array, series or dataframe, optional</span></dt><dd><p>Treatment status at test points. If specified, also <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_mu</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">pihat</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">x_tau</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_aux</span></code> (the latter two if and only also specified at
initialization) must be specified.</p>
</dd>
<dt><strong>x_mu</strong><span class="classifier">(m, p) array, series or dataframe, optional</span></dt><dd><p>Control model covariates at test points.</p>
</dd>
<dt><strong>x_tau</strong><span class="classifier">(m, q) array, series or dataframe, optional</span></dt><dd><p>Moderating model covariates at test points.</p>
</dd>
<dt><strong>pihat</strong><span class="classifier">(m,) array, series or dataframe, optional</span></dt><dd><p>Estimated propensity score at test points.</p>
</dd>
<dt><strong>x_aux</strong><span class="classifier">(m, k) array, series or dataframe, optional</span></dt><dd><p>Additional covariates for the <code class="docutils literal notranslate"><span class="pre">'aux'</span></code> process.</p>
</dd>
<dt><strong>weights</strong><span class="classifier">(m,) array, series or dataframe, optional</span></dt><dd><p>Weights for the error variance on the test points.</p>
</dd>
<dt><strong>rng</strong><span class="classifier">numpy.random.Generator, optional</span></dt><dd><p>Random number generator, used if <code class="docutils literal notranslate"><span class="pre">hp</span> <span class="pre">==</span> <span class="pre">'sample'</span></code>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl>
<dt><strong>gp</strong><span class="classifier">GP</span></dt><dd><p>A centered Gaussian process object. To add the mean, use the <code class="xref py py-obj docutils literal notranslate"><span class="pre">m</span></code>
attribute of the <a class="reference internal" href="#lsqfitgp.bayestree.bcf" title="lsqfitgp.bayestree.bcf"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bcf</span></code></a> object. The keys of the GP are <code class="docutils literal notranslate"><span class="pre">'&#64;mean'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'&#64;noise'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'&#64;'</span></code>, where the “&#64;” stands either for ‘train’
or ‘test’, and &#64; = &#64;mean + &#64;noise.</p>
<p>This Gaussian process is defined on the transformed data <code class="docutils literal notranslate"><span class="pre">eta</span></code>.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lsqfitgp.bayestree.bcf.pred">
<span class="sig-name descname"><span class="pre">pred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_mu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_tau</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pihat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_aux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transformed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gvars</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/Gattocrucco/lsqfitgp/blob/v0.21/src/lsqfitgp/bayestree/_bcf.py#L696-L822"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lsqfitgp.bayestree.bcf.pred" title="Link to this definition">¶</a></dt>
<dd><p>Predict the transformed outcome at given locations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>hp</strong><span class="classifier">str or dict</span></dt><dd><p>The hyperparameters to use. If <code class="docutils literal notranslate"><span class="pre">'map'</span></code> (default), use the marginal
maximum a posteriori. If <code class="docutils literal notranslate"><span class="pre">'sample'</span></code>, sample hyperparameters from
the posterior. If a dict, use the given hyperparameters.</p>
</dd>
<dt><strong>error</strong><span class="classifier">bool, default False</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, make a prediction for the latent mean. If <code class="docutils literal notranslate"><span class="pre">True</span></code>,
add the error term.</p>
</dd>
<dt><strong>z</strong><span class="classifier">(m,) array, series or dataframe, optional</span></dt><dd><p>Treatment status at test points. If specified, also <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_mu</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">pihat</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">x_tau</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">x_aux</span></code> (the latter two if and only also specified at
initialization) must be specified.</p>
</dd>
<dt><strong>x_mu</strong><span class="classifier">(m, p) array, series or dataframe, optional</span></dt><dd><p><span class="math notranslate nohighlight">\(\mu\)</span> model covariates at test points.</p>
</dd>
<dt><strong>x_tau</strong><span class="classifier">(m, q) array, series or dataframe, optional</span></dt><dd><p><span class="math notranslate nohighlight">\(\tau\)</span> model covariates at test points.</p>
</dd>
<dt><strong>pihat</strong><span class="classifier">(m,) array, series or dataframe, optional</span></dt><dd><p>Estimated propensity score at test points.</p>
</dd>
<dt><strong>x_aux</strong><span class="classifier">(m, k) array, series or dataframe, optional</span></dt><dd><p>Additional covariates for the <code class="docutils literal notranslate"><span class="pre">'aux'</span></code> process at test points.</p>
</dd>
<dt><strong>weights</strong><span class="classifier">(m,) array, series or dataframe, optional</span></dt><dd><p>Weights for the error variance on the test points.</p>
</dd>
<dt><strong>transformed</strong><span class="classifier">bool, default True</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, return the prediction on the transformed outcome
<span class="math notranslate nohighlight">\(\eta\)</span>, else the observable outcome <span class="math notranslate nohighlight">\(y\)</span>.</p>
</dd>
<dt><strong>samples</strong><span class="classifier">int, optional</span></dt><dd><p>If specified, indicates the number of samples to take from the
posterior. If not, return the mean and covariance matrix of the
posterior.</p>
</dd>
<dt><strong>gvars</strong><span class="classifier">bool, default False</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, return the mean and covariance matrix of the posterior
as an array of <code class="xref py py-obj docutils literal notranslate"><span class="pre">GVar</span></code> variables.</p>
</dd>
<dt><strong>rng</strong><span class="classifier">numpy.random.Generator, optional</span></dt><dd><p>Random number generator, used if <code class="docutils literal notranslate"><span class="pre">hp</span> <span class="pre">==</span> <span class="pre">'sample'</span></code> or <code class="docutils literal notranslate"><span class="pre">samples</span></code>
is not <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>If <code class="docutils literal notranslate"><span class="pre">samples</span></code> is <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code> and <code class="docutils literal notranslate"><span class="pre">gvars</span></code> is <code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code> (default):</dt><dd></dd>
<dt><strong>mean, cov</strong><span class="classifier">(m,) and (m, m) arrays</span></dt><dd><p>The mean and covariance matrix of the Normal posterior distribution
over the regression function or <span class="math notranslate nohighlight">\(\eta\)</span> at the specified
locations.</p>
</dd>
<dt>If <code class="docutils literal notranslate"><span class="pre">samples</span></code> is <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code> and <code class="docutils literal notranslate"><span class="pre">gvars</span></code> is <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code>:</dt><dd></dd>
<dt><strong>out</strong><span class="classifier">(m,) array of gvars</span></dt><dd><p>The same distribution represented as an array of <a class="reference external" href="https://gvar.readthedocs.io/en/latest/gvar.html#gvar.GVar" title="(in gvar v13.1.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GVar</span></code></a>
objects.</p>
</dd>
<dt>If <code class="docutils literal notranslate"><span class="pre">samples</span></code> is an integer:</dt><dd></dd>
<dt><strong>sample</strong><span class="classifier">(samples, m) array</span></dt><dd><p>Posterior samples over either the regression function, <span class="math notranslate nohighlight">\(\eta\)</span>,
or <span class="math notranslate nohighlight">\(y\)</span>.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="lsqfitgp.bayestree.bcf.to_data">
<span class="sig-name descname"><span class="pre">to_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eta</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/Gattocrucco/lsqfitgp/blob/v0.21/src/lsqfitgp/bayestree/_bcf.py#L869-L891"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lsqfitgp.bayestree.bcf.to_data" title="Link to this definition">¶</a></dt>
<dd><p>Convert the regression variable <span class="math notranslate nohighlight">\(\eta\)</span> to outcomes <span class="math notranslate nohighlight">\(y\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>eta</strong><span class="classifier">(n,) array</span></dt><dd><p>Transformed outcomes.</p>
</dd>
<dt><strong>hp</strong><span class="classifier">str or dict</span></dt><dd><p>The hyperparameters to use. If <code class="docutils literal notranslate"><span class="pre">'map'</span></code> (default), use the marginal
maximum a posteriori. If <code class="docutils literal notranslate"><span class="pre">'sample'</span></code>, sample hyperparameters from
the posterior. If a dict, use the given hyperparameters.</p>
</dd>
<dt><strong>rng</strong><span class="classifier">numpy.random.Generator, optional</span></dt><dd><p>Random number generator, used if <code class="docutils literal notranslate"><span class="pre">hp</span> <span class="pre">==</span> <span class="pre">'sample'</span></code>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt><strong>y</strong><span class="classifier">(n,) array</span></dt><dd><p>Outcomes.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="copula.html" title="Previous document">Gaussian copulas</a>
        </li>
        <li>
          <a href="gvarext.html" title="Next document">Gvar extensions</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2020-2024, Giacomo Petrillo.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/reference/bayestree.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>